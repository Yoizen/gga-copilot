# ðŸ¤– Gentleman Guardian Angel

**Provider-agnostic AI code review** â€” Enforce coding standards on every commit using Claude, Gemini, Codex, Ollama, or any LLM. **Pure Bash** (Linux/Mac) or **PowerShell** (Windows).

![Version](https://img.shields.io/badge/version-2.2.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Bash](https://img.shields.io/badge/bash-5.0%2B-orange.svg)
![Tests](https://img.shields.io/badge/tests-68%20passing-brightgreen.svg)

## Why?

Automate code review enforcement on every commit. Validate staged files against your `REVIEW.md` rulesâ€”like having a senior developer review every line before it hits the repo.

## Installation

### macOS/Linux - Homebrew
```bash
brew tap gentleman-programming/tap
brew install gga
```

### macOS/Linux - Manual
```bash
git clone https://github.com/Gentleman-Programming/gentleman-guardian-angel.git
cd gga && ./install.sh
```

### Windows - PowerShell
```powershell
git clone https://github.com/Gentleman-Programming/gentleman-guardian-angel.git
cd gga
PowerShell.exe -ExecutionPolicy Bypass -File install.ps1
```

**Note:** Windows requires PowerShell 5.0+. If execution is restricted:
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

## Quick Start

```bash
cd ~/your-project
gga init               # Create .gga config (default: copilot:claude-haiku-4.5)
touch REVIEW.md        # Create your coding standards
gga install            # Install pre-commit hook
git add . && git commit -m "feat: done"  # Review runs automatically âœ…
```

## Configuration

### `.gga` Config File (Auto-generated by `gga init`)

```bash
PROVIDER="copilot:claude-haiku-4.5"        # AI provider (default)
FILE_PATTERNS="*.ts,*.tsx,*.js,*.jsx"     # Files to review
EXCLUDE_PATTERNS="*.test.ts,*.spec.ts"    # Files to skip
RULES_FILE="REVIEW.md"                    # Your rules file
STRICT_MODE="true"                        # Fail on ambiguous responses
```

### `REVIEW.md` Rules File

```markdown
# Code Review Rules

## TypeScript
- No `any` types - use proper typing
- Use `const` over `let` when possible
- Prefer interfaces over type aliases

## React
- Use functional components with hooks
- No `import * as React` - use named imports
- All images must have alt text

## Testing
- All new features need tests
- Test files must be co-located with source
```

### Templates

Pre-configured templates available:
- **`.gga.copilot-claude-haiku-template`** â€” GitHub Copilot with Claude Haiku 4.5 (lightweight, fast)

## Commands

| Command | Description |
|---------|-------------|
| `gga init` | Create sample `.gga` config |
| `gga install` | Install pre-commit hook |
| `gga uninstall` | Remove pre-commit hook |
| `gga run` | Run review on staged files |
| `gga run --no-cache` | Force review ignoring cache |
| `gga config` | Display current configuration |
| `gga cache status` | Show cache status |
| `gga cache clear` | Clear project cache |
| `gga cache clear-all` | Clear all cached data |
| `gga help` | Show all commands |
| `gga version` | Show version |

## Providers

| Provider | Config | Installation |
|----------|--------|--------------|
| **Claude** | `claude` | [claude.ai/code](https://claude.ai/code) |
| **Gemini** | `gemini` | [google-gemini/gemini-cli](https://github.com/google-gemini/gemini-cli) |
| **Codex** | `codex` | `npm i -g @openai/codex` |
| **GitHub Copilot** | `copilot:<model>` | [copilot-api](https://github.com/aaamoon/copilot-api) on port 4141 |
| **Ollama** | `ollama:<model>` | [ollama.ai](https://ollama.ai) |

Examples:
```bash
PROVIDER="claude"
PROVIDER="gemini"
PROVIDER="copilot:claude-haiku-4.5"        # Claude Haiku 4.5
PROVIDER="copilot:gpt-4o"                  # GPT-4 Omni
PROVIDER="ollama:llama3.2"
PROVIDER="ollama:codellama"
```

## Smart Caching

Automatically skips unchanged files for faster reviews. Cache invalidates when `REVIEW.md` or `.gga` changes.

```bash
gga cache status      # Check cache
gga cache clear       # Clear for current project
gga cache clear-all   # Clear all projects
gga run --no-cache    # Force full review
```

## How It Works

```
git commit
    â†“
1. Load config (.gga)
2. Validate provider installed
3. Check rules file (REVIEW.md) exists
4. Get staged files matching patterns
5. Read coding rules
6. Send rules + files to AI
7. Parse response (PASSED/FAILED)
8. Allow/block commit
```

## Integration

### Native Git Hook (Default)
The `gga install` command automatically installs a pre-commit hook.

### Husky (JavaScript/TypeScript)
```bash
npm install -D husky
npx husky init

# Edit .husky/pre-commit
gga run || exit 1
```

### pre-commit (Python)
```yaml
# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: gga
        name: Gentleman Guardian Angel
        entry: gga run
        language: system
        pass_filenames: false
```

### Lefthook (All languages)
```yaml
# lefthook.yml
pre-commit:
  parallel: false
  commands:
    ai-review:
      run: gga run
```

## Bypass Review

```bash
git commit --no-verify -m "wip: work in progress"
git commit -n -m "hotfix: urgent fix"
```

## Troubleshooting

**"Provider not found"**
```bash
which claude  # Verify provider is in PATH
echo "Say hello" | claude --print  # Test provider
```

**"Rules file not found"**
```bash
touch REVIEW.md
echo "# My Coding Standards" > REVIEW.md
```

**"Ambiguous response" in Strict Mode**
- Try Claude (most reliable)
- Simplify your rules file
- Temporarily disable: `STRICT_MODE="false"`

## Development

```bash
# Install test dependencies
brew install shellspec shellcheck

# Run all tests (68 total)
make test

# Run specific tests
make test-unit        # Unit tests
make test-integration # Integration tests

# Lint and test
make check
```

## Project Structure

```
gentleman-guardian-angel/
â”œâ”€â”€ bin/gga                    # Main CLI script
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ providers.sh           # AI provider implementations
â”‚   â””â”€â”€ cache.sh               # Smart caching
â”œâ”€â”€ spec/                      # Test suite (68 tests)
â”œâ”€â”€ Makefile
â”œâ”€â”€ install.sh
â”œâ”€â”€ uninstall.sh
â””â”€â”€ README.md
```

## License

MIT Â© 2024

---

<p align="center">
  <sub>Built with ðŸ§‰ by developers tired of repeating the same code review comments</sub>
</p>
